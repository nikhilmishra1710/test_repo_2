name: check-logging

on:
  pull_request:
    branches: [master]

permissions:
  contents: read
  pull-requests: write
  checks: write

jobs:
  check-logging:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout and fetch base
        run: |
            git init
            git remote add origin "${{ github.event.repository.clone_url }}"
            git fetch origin master
            git fetch origin ${{ github.head_ref }}
            git checkout -b pr_branch origin/${{ github.head_ref }}
            git branch --track master origin/master

      - name: Determine diff range
        id: diff
        run: |
            base=$(git merge-base master pr_branch)
            echo "range=$base...pr_branch" >> "$GITHUB_OUTPUT"


      - name: Setup Python manually
        run: |
          sudo apt-get update
          sudo apt-get install -y python3 python3-pip
          python3 --version

      - name: Run logging check
        id: logcheck
        env:
          DIFF_RANGE: ${{ steps.diff.outputs.range }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          python3 .github/scripts/check_logging.py

      

